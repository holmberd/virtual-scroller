var h={DOWN:"down",UP:"up"};function d(i,t){let e=[];for(let o=0;o<i;o++){if(!o){e[o]=t(o);continue}e[o]=e[o-1]+t(o)}return e}function m(i,t,e){if(!e){let l=0,n=l,c=i.length;for(;n<c&&!(r(i,n)>t);n++);return[l,n]}let o=v(i,l=>l>e),s=v(i,l=>l>e+t,o);return[o,s]}function b(i,t,e,o,s=h.DOWN,l){let n=g(i,e,o);if(!l&&s===h.DOWN)return[0,n-t];let c=r(i,e-1),a=l-c,u=n-t-a;return s===h.UP?[a,p(i,o)-u]:[p(i,e)-a,u]}function S(i,t,e){let o=i.length;I(o,t,e);let s=r(i,t-1),l=e>=o-1?0:g(i,e+1,o-1);return[s,l]}function g(i,t,e){I(i.length,t,e);let o=r(i,e),s=r(i,t-1);return o-s}function p(i,t){return r(i,t)-r(i,t-1)}function r(i,t){if(!i)throw Error("Missing required argument: itemsScrollIndex");return i[t]||0}function I(i,t,e){if(t>e)throw Error("start index must come before stop index");if(t<0||e<0||e>=i)throw Error("startIndex must be > -1 and -1 < stopIndex < itemCount");return!0}function v(i,t,e=-1){let o=i.length-1;for(;e+1<o;){let s=e+(o-e>>1);t(i[s])?o=s:e=s}return o}function w(i,t){var e=Date.now();return function(){e+t-Date.now()<0&&(i(),e=Date.now())}}var x=document.createElement("template"),H=new CSSStyleSheet;H.replaceSync(`
  :host {
    display: block;
    position: relative;
    contain: content;
    overflow: scroll;
    overflow-x: hidden;
  }
  #top-overflow, #bottom-overflow {
    visibility: hidden;
  }
`);x.innerHTML=`
  <div id='top-overflow'></div>
  <slot></slot>
  <div id='bottom-overflow'></div>
`;var O={VISIBLE_RANGE_CHANGE:"visibleRangeChange"},f=class extends HTMLElement{constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(document.importNode(x.content,!0)),t.adoptedStyleSheets=[H],this.itemCount=0,this.visibleOffset=0,this.lastScrollPosition=0,this.visibleStartIndex=0,this.visibleStopIndex=0,this.observer=null,this.throttle=0,this._itemsScrollIndex=[],this._clientHeightCache=0,this._calcItemHeight=()=>0}get calcItemHeight(){return this._calcItemHeight}set calcItemHeight(t){this._calcItemHeight=t}get height(){return this._clientHeightCache||this.clientHeight}set height(t){this._clientHeightCache=t}get itemsScrollIndex(){return this._itemsScrollIndex}set itemsScrollIndex(t){this._itemsScrollIndex=t}connectedCallback(){this.height=this.clientHeight,this.lastScrollPosition=this.scrollTop;let t=w(this.handleScroll.bind(this),this.throttle);this.addEventListener("scroll",t)}disconnectedCallback(){}init(t,e){this.itemCount=t,this.calcItemHeight=e,this.itemsScrollIndex=d(this.itemCount,this.calcItemHeight),this.update()}resetItemsScrollIndex(){this.itemsScrollIndex=d(this.itemCount,this.calcItemHeight),this.update()}update(){let[t,e]=m(this.itemsScrollIndex,this.height,this.scrollTop);this.updateVisibleItemIndexes(t,e)}updateVisibleItemIndexes(t,e){if(this.visibleStartIndex===t&&this.visibleStopIndex===e)return;this.visibleStartIndex=t,this.visibleStopIndex=e;let o=t===0||t-this.visibleOffset<0?0:t-this.visibleOffset,s=e===0?0:e+this.visibleOffset>=this.itemCount?this.itemCount-1:e+this.visibleOffset;this.updateScrollOverflow(o,s),this.dispatchEvent(new CustomEvent(O.VISIBLE_RANGE_CHANGE,{detail:{startIndex:o,stopIndex:s},bubbles:!0}))}handleScroll(t){let e=this.scrollTop,s=e-this.lastScrollPosition>0;this.lastScrollPosition=e;let[l,n]=b(this.itemsScrollIndex,this.height,this.visibleStartIndex,this.visibleStopIndex,s?h.DOWN:h.UP,e);if(console.log("threshold",n,l),n<0||l<0){let[c,a]=m(this.itemsScrollIndex,this.height,e);this.updateVisibleItemIndexes(c,a)}}updateScrollOverflow(t,e){let[o,s]=S(this.itemsScrollIndex,t,e);this.setTopOverflowHeight(o),this.setBottomOverflowHeight(s)}setBottomOverflowHeight(t){let e=this.shadowRoot.querySelector("#bottom-overflow");e.style.height=`${Math.max(0,t)}px`}setTopOverflowHeight(t){let e=this.shadowRoot.querySelector("#top-overflow");e.style.height=`${Math.max(0,t)}px`}};customElements.get("virtual-scroller")||customElements.define("virtual-scroller",f);export{f as default};
//# sourceMappingURL=virtual-scroller.esm.js.map
